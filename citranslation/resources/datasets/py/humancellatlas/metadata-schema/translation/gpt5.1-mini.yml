name: CI

on:
  push:
  pull_request:

jobs:
  schema_linter:
    name: Schema linter
    runs-on: ubuntu-latest
    env:
      BRANCH: ${{ github.head_ref || github.ref_name }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.6
        uses: actions/setup-python@v4
        with:
          python-version: '3.6'

      - name: Run schema linter
        working-directory: src
        run: python schema_linter.py --environment "${BRANCH}"

      - name: Notify Slack (linter)
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          fields: repo,commit,author,workflow
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}

  schema_tests:
    name: Schema tests
    runs-on: ubuntu-latest
    needs: schema_linter
    env:
      BRANCH: ${{ github.head_ref || github.ref_name }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js 8
        uses: actions/setup-node@v4
        with:
          node-version: '8'

      - name: Install dependencies
        run: npm install
        working-directory: tests

      - name: Run tests
        run: npm test
        working-directory: tests

      - name: Notify Slack (tests)
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          fields: repo,commit,author,workflow
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}

|End-of-Code|
name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu:24.04
    strategy:
      matrix:
        python: ["3.8", "3.9", "3.10"]
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python }}
      - name: Install nvm
        run: |
          curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
          export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
          [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
      - name: Install Node.js
        run: |
          nvm install
          nvm use
      - name: Install Python dependencies
        run: |
          pip install --upgrade pip setuptools wheel
          pip install -r requirements-dev.txt
      - name: Run script steps
        run: |
          cp django_airavata/settings_local.py.sample django_airavata/settings_local.py
          python manage.py migrate
          python manage.py check
          flake8 .
          ./lint_js.sh
          ./build_js.sh
          ./test_js.sh
          ./runtests.py
|End-of-Code|